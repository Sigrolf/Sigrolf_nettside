# Copilot Instructions for this Repo

These instructions help AI coding agents quickly understand and work productively in this codebase.

## Big Picture
- Static photography site with HTML/CSS/JS at the root; data-driven rendering powered by Node scripts.
- Image metadata is synced from Cloudinary into `_data/images.yml`, then injected into HTML via `scripts/generate-preview.js`.
- Build workflow copies generated pages from `preview/` to both `deploy/` and root so GitHub Pages serves the latest content.
- A separate `mysite/` Jekyll skeleton exists but is not part of the Node-based build; treat it as experimental unless instructed otherwise.

## Core Data Flow
- Cloudinary → `_data/images.yml` → `preview/*.html` → `deploy/*.html` and root `*.html`.
- Source of truth: `_data/images.yml` (array of objects: `url`, `public_id`, `title`, `caption`, `category`, `featured`). See `_data/images.yml` for real examples.
- Categories are derived from Cloudinary folder names (e.g., `images/astro`, `images/landscapes`, `images/wildlife`). Tag `featured` in Cloudinary to surface items in home and showcase.
- Special category: `Of_the_photographer` is used for the portrait on `about.html` when present.

## Commands & Workflows
- Build everything:
  - `npm run build:site` → Generates preview pages and copies them into `deploy/` and root (index/about/showcase/portfolio).
- Sync Cloudinary images:
  - `npm run sync:cloudinary` → Reads default folder `images` using `.env` credentials.
  - `npm run sync:wildlife` → Example multi-folder sync using `CLOUDINARY_FOLDERS` env override.
- Preview locally:
  - Serve the `preview/` folder with a static server (e.g., VS Code Live Server) after running `build:preview`.
- Upload local images to Cloudinary:
  - `node scripts/upload-to-cloudinary.js --pattern "images/**/*.{jpg,png,webp}"` (supports `--dry-run`). Run sync afterwards.

## Environment
- Required for sync/upload scripts: `CLOUDINARY_CLOUD_NAME`, `CLOUDINARY_API_KEY`, `CLOUDINARY_API_SECRET` in `.env`.
- Optional:
  - `CLOUDINARY_FOLDER` (default `images`), `CLOUDINARY_FOLDERS` (comma-separated), `CLOUDINARY_SEARCH_EXPRESSION` (advanced), `CLOUDINARY_FALLBACK_CATEGORY`.

## Rendering & Templates
- `scripts/generate-preview.js` reads root templates and replaces Liquid-like blocks with static HTML:
  - Home featured loop (`{% for img in featured %} ... {% endfor %}`) → populated from `featured` or first 3 images.
  - `about.html` portrait `<img.about-portrait>` → replaced when category `Of_the_photographer` exists.
  - `portfolio.html` gallery section: builds category buttons and grouped image grids with `data-category`.
  - Defaults to `astro` as first category when present; adds i18n labels via `data-i18n-*` attributes.
- Output written to `preview/` (index/portfolio/about/showcase/blog as applicable), then copied by `build:site`.

## Frontend Behavior
- `script.js` controls:
  - Lightbox with keyboard/swipe navigation and details panel.
  - Language persistence (`?lang=en|nb` + `localStorage`) and i18n labels for category buttons.
  - Gallery interactions relying on DOM `data-` attributes generated by the preview script.

## Conventions to Follow
- Prefer adding new images via Cloudinary and resync; do not hand-edit `_data/images.yml` unless necessary.
- Use Cloudinary folder names to drive `category` and tag `featured` to curate homepage and showcase.
- If adding a new page that depends on images, extend `scripts/generate-preview.js` to inject markup consistently, then include it in `build:site` copy steps.

## Key Files & Directories
- `package.json` → npm scripts orchestrating sync/build/copy.
- `scripts/` → `sync-cloudinary-images.js`, `generate-preview.js`, `upload-to-cloudinary.js`.
- `_data/images.yml` → image metadata (synced, do not manually curate when avoidable).
- `preview/` and `deploy/` → generated outputs; root HTML files are also overwritten on build.
- `blog/` → static posts referenced by `blog.html`; preview copies `blog.html` unchanged.

## Practical Examples
- Mark a photo featured: add Cloudinary tag `featured`, run `npm run sync:cloudinary`, then `npm run build:site`.
- Add a new category: upload images under `images/<new-category>/...`, sync and build; `generate-preview.js` will auto-create buttons and grids.
- Update portrait: place an image in category `Of_the_photographer` and rebuild; `about.html` will reflect it in preview/deploy.
